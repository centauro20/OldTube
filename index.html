<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OldTube - La Máquina del Tiempo</title>
    <style>
        :root {
            --bg-color: #f1f1f1; --header-bg: #ffffff; --text-color: #333;
            --filter-bg: #e6e6e6; --border-color: #ccc; --title-color: #0033cc;
        }
        [data-theme="dark"] {
            --bg-color: #181818; --header-bg: #202020; --text-color: #fff;
            --filter-bg: #2a2a2a; --border-color: #444; --title-color: #3ea6ff;
        }
        body { font-family: Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; transition: 0.3s; }
        header { background: var(--header-bg); padding: 10px 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        .logo { height: 45px; cursor: pointer; }
        
        .search-area { flex-grow: 1; margin: 0 20px; position: relative; }
        .search-bar { display: flex; }
        .search-bar input { width: 100%; padding: 10px; border: 1px solid var(--border-color); background: var(--header-bg); color: var(--text-color); outline: none; }
        
        #autocomplete-results { position: absolute; background: var(--header-bg); width: 100%; border: 1px solid var(--border-color); display: none; z-index: 200; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .suggestion { padding: 10px; cursor: pointer; border-bottom: 1px solid var(--border-color); color: var(--text-color); }
        .suggestion:hover { background: var(--filter-bg); }

        .filters { background: var(--filter-bg); padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .btn-theme, .btn-shorts { padding: 8px 15px; cursor: pointer; border: none; font-weight: bold; width: 120px; }
        .btn-theme { background: #cc0000; color: white; }
        .btn-shorts { background: #555; color: white; margin-top: 5px; }

        .tendencias { padding: 10px; text-align: center; background: var(--bg-color); }
        .tag { display: inline-block; padding: 5px 12px; background: #ddd; margin: 3px; border-radius: 15px; font-size: 12px; cursor: pointer; color: #333; }

        #video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; padding: 20px; }
        
        .video-card { background: var(--header-bg); border: 1px solid var(--border-color); padding: 10px; cursor: pointer; }
        .thumb-container { position: relative; }
        .duration { position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.8); color: white; padding: 2px 5px; font-size: 11px; border-radius: 2px; }
        .video-card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .video-card h3 { font-size: 14px; color: var(--title-color); margin: 10px 0 5px; height: 38px; overflow: hidden; }
        .video-card p { font-size: 12px; color: #777; margin: 2px 0; }

        /* REPRODUCTOR */
        #player-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; }
        .player-container { display: flex; max-width: 1300px; margin: 20px auto; gap: 20px; padding: 20px; flex-wrap: wrap; }
        .main-content { flex: 2; min-width: 600px; color: white; }
        .side-videos { flex: 1; min-width: 300px; color: white; border-left: 1px solid #444; padding-left: 20px; max-height: 85vh; overflow-y: auto; }
        .video-info { background: #222; padding: 15px; margin-top: -5px; }
        .close-btn { position: fixed; top: 10px; right: 30px; color: white; font-size: 45px; cursor: pointer; z-index: 1100; }
        iframe { width: 100%; aspect-ratio: 16/9; border: none; background: #000; }

        /* ESTILOS PARA MÓVIL (Responsivo Retro) */
        @media (max-width: 768px) {
            header { flex-direction: column; height: auto; padding: 10px; }
            .search-area { width: 100%; margin: 10px 0; }
            .logo { height: 35px; margin-bottom: 5px; }
            #video-grid { grid-template-columns: 1fr; padding: 10px; }
            .player-container { padding: 5px; margin: 0; }
            .main-content { min-width: 100%; }
            .side-videos { border-left: none; padding-left: 0; margin-top: 20px; }
            .video-card h3 { height: auto; font-size: 16px; }
            .btn-theme { width: 100%; margin-bottom: 5px; }
            .close-btn { right: 15px; top: 5px; font-size: 35px; }
        }
    </style>
</head>
<body onload="inicio()">

<header>
    <img src="logo.png" alt="OldTube" class="logo" onclick="location.reload()">
    <div class="search-area">
        <div class="search-bar">
            <input type="text" id="query" placeholder="Busca en el pasado..." oninput="autocompletar()">
            <button onclick="buscar(true)">Buscar</button>
        </div>
        <div id="autocomplete-results"></div>
    </div>
    <div style="display: flex; flex-direction: column; width: auto;">
        <button class="btn-theme" onclick="cambiarModo()" id="btnModo">Modo: OG</button>
        <button class="btn-shorts" onclick="alert('¡ESTO ES EL YOUTUBE ANTIGUO, AQUÍ NO HAY SHORTS!')">Shorts</button>
    </div>
</header>

<div class="filters">
    <label>Desde: </label><input type="number" id="yearStart" value="2006" style="width: 60px;" onchange="buscar(true)">
    <label> Hasta: </label><input type="number" id="yearEnd" value="2014" style="width: 60px;" onchange="buscar(true)">
    <select id="idioma" style="margin-left: 5px;" onchange="buscar(true)">
        <option value="">Idioma</option>
        <option value="es">Español</option>
        <option value="en">Inglés</option>
    </select>
</div>

<div class="tendencias">
    <span class="tag" onclick="tagSearch('Minecraft 2012')">Minecraft 2012</span>
    <span class="tag" onclick="tagSearch('Rubius 2013')">Rubius Clásico</span>
    <span class="tag" onclick="tagSearch('Willyrex 2011')">Willyrex</span>
</div>

<main id="video-grid"></main>

<div id="player-modal">
    <span class="close-btn" onclick="cerrarPlayer()">&times;</span>
    <div class="player-container">
        <div class="main-content">
            <div id="video-espacio"></div>
            <div id="detalles-video" class="video-info"></div>
            <div id="lista-comentarios" style="margin-top:20px; background:#111; padding:15px;"></div>
        </div>
        <div class="side-videos" id="side-scroll">
            <h4 style="margin-top:0;">Recomendados de la época:</h4>
            <div id="lista-sugerencias"></div>
            <button onclick="cargarSugerenciasInfinitas()" style="width:100%; padding:10px; cursor:pointer; background:#444; color:white; border:none;">Cargar más</button>
        </div>
    </div>
</div>

<script>
    const API_KEY = 'AIzaSyB0rP8g3h7JeOResZ8Qo5W2dd-H3cPC7z4';
    let nextToken = "";
    let nextSideToken = "";
    let currentId = "";

    function inicio() { buscar(true); }
    function tagSearch(t) { document.getElementById('query').value = t; buscar(true); }

    async function autocompletar() {
        const q = document.getElementById('query').value;
        const resBox = document.getElementById('autocomplete-results');
        if(q.length < 3) { resBox.style.display = 'none'; return; }
        const res = await fetch(`https://suggestqueries.google.com/complete/search?client=firefox&q=${q}`);
        const data = await res.json();
        resBox.innerHTML = "";
        data[1].slice(0, 5).forEach(s => {
            const d = document.createElement('div');
            d.className = 'suggestion';
            d.innerText = s;
            d.onclick = () => { document.getElementById('query').value = s; resBox.style.display = 'none'; buscar(true); };
            resBox.appendChild(d);
        });
        resBox.style.display = 'block';
    }

    async function buscar(nueva = true) {
        const queryInput = document.getElementById('query').value;
        const start = document.getElementById('yearStart').value;
        const end = document.getElementById('yearEnd').value;
        const lang = document.getElementById('idioma').value;
        const grid = document.getElementById('video-grid');
        
        if(nueva) { nextToken = ""; grid.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>Cargando el pasado...</p>"; }

        const searchTerm = queryInput || (lang === 'es' ? 'popular viral' : 'viral classic');
        const q = `${searchTerm} after:${start}-01-01 before:${end}-12-31`;
        let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(q)}&type=video&key=${API_KEY}${nextToken ? '&pageToken='+nextToken : ''}`;
        if(lang) url += `&relevanceLanguage=${lang}`;

        try {
            const res = await fetch(url);
            const data = await res.json();
            nextToken = data.nextPageToken;
            if(nueva) grid.innerHTML = "";

            data.items.forEach(item => {
                const id = item.id.videoId;
                const snip = item.snippet;
                grid.innerHTML += `
                    <div class="video-card" onclick="verVideo('${id}', '${snip.title.replace(/'/g, "")}', '${snip.channelTitle}')">
                        <img src="${snip.thumbnails.high.url}">
                        <h3>${snip.title}</h3>
                        <p><strong>${snip.channelTitle}</strong></p>
                        <p>${new Date(snip.publishedAt).toLocaleDateString()}</p>
                    </div>`;
            });
        } catch(e) { console.error(e); }
    }

    async function verVideo(id, titulo, canal) {
        currentId = id;
        const modal = document.getElementById('player-modal');
        modal.style.display = "block";
        document.body.style.overflow = "hidden";
        document.getElementById('video-espacio').innerHTML = `<iframe src="https://www.youtube-nocookie.com/embed/${id}?autoplay=1&rel=0&modestbranding=1" allowfullscreen></iframe>`;
        document.getElementById('detalles-video').innerHTML = `<h2 style="color:white; font-size:18px;">${titulo}</h2><p style="color:#3ea6ff;">${canal}</p>`;
        document.getElementById('lista-sugerencias').innerHTML = "";
        cargarSugerenciasInfinitas();
        cargarComentarios(id);
    }

    async function cargarSugerenciasInfinitas() {
        const start = document.getElementById('yearStart').value;
        const end = document.getElementById('yearEnd').value;
        const lang = document.getElementById('idioma').value;
        const q = `after:${start}-01-01 before:${end}-12-31`;
        
        let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(q)}&type=video&key=${API_KEY}${nextSideToken ? '&pageToken='+nextSideToken : ''}`;
        if(lang) url += `&relevanceLanguage=${lang}`;

        try {
            const res = await fetch(url);
            const data = await res.json();
            nextSideToken = data.nextPageToken;
            const lista = document.getElementById('lista-sugerencias');

            data.items.forEach(item => {
                const lowT = item.snippet.title.toLowerCase();
                if(item.id.videoId === currentId || lowT.includes("#shorts") || lowT.includes("shorts")) return;

                lista.innerHTML += `
                    <div style="display:flex; gap:10px; margin-bottom:15px; cursor:pointer;" onclick="verVideo('${item.id.videoId}', '${item.snippet.title.replace(/'/g, "")}', '${item.snippet.channelTitle}')">
                        <img src="${item.snippet.thumbnails.default.url}" style="width:110px; aspect-ratio:16/9; object-fit:cover;">
                        <div style="flex:1;">
                            <p style="font-size:11px; margin:0; font-weight:bold; color:white;">${item.snippet.title}</p>
                            <p style="font-size:10px; color:#aaa;">${item.snippet.channelTitle}</p>
                        </div>
                    </div>`;
            });
        } catch(e) { console.error(e); }
    }

    async function cargarComentarios(id) {
        const lista = document.getElementById('lista-comentarios');
        lista.innerHTML = "<h4>Comentarios:</h4>";
        try {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${id}&maxResults=8&key=${API_KEY}`);
            const data = await res.json();
            data.items.forEach(c => {
                const comm = c.snippet.topLevelComment.snippet;
                lista.innerHTML += `<div style="border-bottom:1px solid #333; padding:10px; font-size:13px; color:white;"><b>${comm.authorDisplayName}</b>: ${comm.textDisplay}</div>`;
            });
        } catch(e) { lista.innerHTML += "<p style='color:#777;'>Comentarios desactivados.</p>"; }
    }

    function cerrarPlayer() { document.getElementById('player-modal').style.display = "none"; document.body.style.overflow = "auto"; document.getElementById('video-espacio').innerHTML = ""; }
    
    function cambiarModo() {
        const body = document.body;
        const btn = document.getElementById('btnModo');
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme'); btn.innerText = "Modo: OG";
        } else {
            body.setAttribute('data-theme', 'dark'); btn.innerText = "Modo: Oscuro";
        }
    }
</script>
</body>
</html>
